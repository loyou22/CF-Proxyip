name: IP Checker

# 配置工作流触发方式
on:
  # 手动触发工作流
  workflow_dispatch:
  # 定时触发，每 6 小时一次
  schedule:
    - cron: '0 */6 * * *'

# 设置权限
permissions:
  contents: write  # 允许修改仓库内容
  actions: read    # 允许读取动作

jobs:
  check-ips:
    runs-on: ubuntu-latest  # 在最新的 Ubuntu 环境中运行

    steps:
      # 第一步：检出仓库代码
      - name: Checkout repository
        uses: actions/checkout@v4  # 检出当前仓库代码

      # 第二步：设置 Python 环境
      - name: Set up Python
        uses: actions/setup-python@v5  # 设置 Python 环境
        with:
          python-version: '3.x'  # 使用 3.x 版本的 Python

      # 第三步：安装依赖
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip  # 升级 pip
          pip install dnspython requests  # 安装 dnspython 和 requests 库

      # 第四步：运行 IP 检查脚本
      - name: Run IP checker script
        run: python DNS2Geo.py  # 执行 DNS2Geo.py 脚本

      # 第五步：提交并推送结果
      - name: Commit and push results
        uses: stefanzweifel/git-auto-commit-action@v5  # 使用 Git 自动提交动作
        with:
          commit_message: 'chore: update IP/country info results'  # 提交信息
          branch: ${{ github.ref }}  # 提交到当前分支
          commit_user_name: github-actions[bot]  # 提交者用户名
          commit_user_email: github-actions[bot]@users.noreply.github.com  # 提交者邮箱
